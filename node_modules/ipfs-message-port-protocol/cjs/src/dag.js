'use strict';

Object.defineProperty(exports, '__esModule', { value: true });

var cid$1 = require('multiformats/cid');
var cid = require('./cid.js');

const decodeNode = ({dagNode, cids}) => {
  for (const cid$1 of cids) {
    cid.decodeCID(cid$1);
  }
  return dagNode;
};
const encodeNode = (dagNode, transfer) => {
  const cids = [];
  collectNode(dagNode, cids, transfer);
  return {
    dagNode,
    cids
  };
};
const collectNode = (value, cids, transfer) => {
  if (value != null && typeof value === 'object') {
    const cid$2 = cid$1.CID.asCID(value);
    if (cid$2) {
      cids.push(cid$2);
      cid.encodeCID(cid$2, transfer);
    } else if (value instanceof ArrayBuffer) {
      if (transfer) {
        transfer.add(value);
      }
    } else if (ArrayBuffer.isView(value)) {
      if (transfer) {
        transfer.add(value.buffer);
      }
    } else if (Array.isArray(value)) {
      for (const member of value) {
        collectNode(member, cids, transfer);
      }
    } else {
      for (const member of Object.values(value)) {
        collectNode(member, cids, transfer);
      }
    }
  }
};

exports.decodeNode = decodeNode;
exports.encodeNode = encodeNode;
